<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CPU Scheduling Simulator - OS Platform</title>
  <style>
    :root{
      --bg:#000;--bg-2:#0a0a0a;--panel:#111;--panel-2:#131313;--line:#222;
      --text:#fff;--muted:#b9c2cc;--accent:#00bfff;--btn:#0078ff;--btn-hover:#005ec9;
      --good:#0ecb81;--warn:#ffcc00;--bad:#ff5c5c;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Arial,system-ui,-apple-system,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

        /* header */
        header{
      position:sticky;top:0;z-index:20;
      display:flex;justify-content:space-between;align-items:center;
      padding:20px 60px;background:var(--bg-2);border-bottom:1px solid var(--line)
    }
    .logo{font-size:1.4em;font-weight:700;color:var(--accent)}
    nav{display:flex;align-items:center;gap:150px}
    .dropdown{
      position:relative;
      display:inline-block;
      padding:6px 0;
      cursor:pointer;
    }
    .dropdown::after{
      content:" ⌄";
      display:inline-block;
      font-size:.8em;
      color:#ccc;
      transition:transform .25s ease,color .25s ease;
    }
    .dropdown:hover::after{
      transform:rotate(180deg);
      color:var(--accent);
    }
    .dropdown-content{
      display:none;
      position:absolute;
      background:#111;
      min-width:180px;
      box-shadow:0 8px 16px rgba(0,0,0,.3);
      z-index:10;
    }
    .dropdown-content a{
      color:#fff;
      padding:10px 14px;
      text-decoration:none;
      display:block;
    }
    .dropdown-content a:hover{background:#333}
    /* 이 줄이 있어야 '호버만으로' 메뉴가 펼쳐져요 */
    .dropdown:hover .dropdown-content{display:block}
    .dropdown > span > a{
      color:#fff;
      text-decoration:none;
    }
    .actions{display:flex;align-items:center;gap:20px}
    .login-btn{
      background:var(--btn);color:#fff;border:none;padding:8px 16px;
      border-radius:20px;cursor:pointer;font-weight:700
    }
    .login-btn:hover{background:var(--btn-hover)}
    .profile-btn{
      background:transparent;border:none;padding:0;cursor:pointer;
      line-height:0;border-radius:999px;outline:none
    }
    .profile-btn svg{
      width:36px;height:36px;
      background:#fff;border-radius:999px;padding:4px
    }
    .profile-btn:hover svg{
      box-shadow:0 0 0 3px rgba(0,191,255,.25)
    }
    @media (max-width:880px){
      header{padding:16px 20px;flex-wrap:wrap;gap:12px}
      nav{gap:40px}
    }


    .wrap{
      max-width:1150px;
      margin:0 auto;
      padding:40px 24px 120px;
      overflow-x:hidden;
    }
    .eyebrow{
      font-size:.9rem;
      letter-spacing:.12em;
      color:var(--muted);
      text-transform:uppercase
    }
    h1{
      margin:.25rem 0 0;
      font-size:2.1rem;
      line-height:1.2;
    }
    .lead{
      margin-top:12px;
      color:#d7e2ea;
      line-height:1.7;
      font-size:.96rem;
    }

    h2.md{
      font-size:1.4rem;
      margin:30px 0 12px;
    }
    h2.md::before{
      content:"\25C6";
      display:inline-block;
      margin-right:8px;
      color:#34b4ff;
      vertical-align:middle;
    }

    .sim-layout{
      display:grid;
      grid-template-columns:minmax(0,1.35fr) minmax(0,1fr);
      gap:20px;
      margin-top:26px;
      align-items:flex-start;
    }
    @media (max-width:960px){
      .sim-layout{grid-template-columns:1fr}
    }

    .panel{
      background:linear-gradient(180deg,var(--panel) 0%,var(--panel-2) 100%);
      border:1px solid var(--line);
      border-radius:16px;
      padding:18px 20px 20px;
    }
    .panel-title{
      font-size:1rem;
      font-weight:600;
      margin-bottom:6px;
    }
    .panel-sub{
      font-size:.86rem;
      color:var(--muted);
      margin-bottom:14px;
    }

    .control-row{
      display:flex;
      flex-wrap:wrap;
      gap:12px 16px;
      margin-bottom:12px;
      align-items:flex-end;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:.85rem;
    }
    .field label{color:#c8d3dc}
    select,input[type="number"],input[type="text"]{
      background:#050506;
      color:var(--text);
      border-radius:10px;
      border:1px solid var(--line);
      padding:6px 8px;
      font-size:.86rem;
      min-width:90px;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{
      -webkit-appearance:none;
      margin:0;
    }

    .btn-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
      margin-bottom:4px;
    }
    .btn{
      border-radius:999px;
      border:1px solid var(--line);
      padding:7px 14px;
      font-size:.85rem;
      cursor:pointer;
      background:#141820;
      color:#dbe7f5;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--btn);
      color:#fff;
      border-color:transparent;
    }
    .btn-primary:hover{background:var(--btn-hover)}
    .btn-danger{
      background:#1b1010;
      color:#ffb3b3;
      border-color:#442020;
    }
    .btn:disabled{
      opacity:0.55;
      cursor:not-allowed;
    }

    .proc-table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      font-size:.86rem;
    }
    .proc-table th,
    .proc-table td{
      border:1px solid var(--line);
      padding:6px 8px;
      text-align:center;
    }
    .proc-table th{
      background:#111319;
      color:#dbe9f5;
      font-weight:500;
    }
    .pid-cell{
      font-weight:600;
      color:#e6f7ff;
      white-space:nowrap;
    }
    .empty-row{
      font-size:.83rem;
      color:#7d8795;
      text-align:center;
    }

    .howto-list{
      list-style:none;
      padding:0;
      margin:0;
      font-size:.87rem;
      color:#c8d3dc;
    }
    .howto-list li+li{margin-top:6px}
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:.78rem;
      padding:3px 8px;
      line-height:1;
      border-radius:999px;
      border:1px solid var(--line);
      color:#9cc7ff;
      background:#0b1a2a;
      vertical-align:middle;
      margin-right:4px;
    }
    .note-box{
      margin-top:12px;
      padding:10px 12px;
      border-radius:10px;
      border:1px dashed #33495f;
      background:#070a10;
      color:#9bb3c7;
      font-size:.82rem;
    }

    hr.sep{
      border:none;
      border-top:1px solid var(--line);
      margin:30px 0 24px;
      opacity:.6;
    }

    .chart-shell{
      margin-top:4px;
      margin-bottom:14px;
      padding:16px 14px 20px;
      border-radius:14px;
      border:1px dashed var(--line);
      background:#05070c;
    }
    .chart-placeholder{
      height:120px;
      border-radius:10px;
      border:1px solid #1d2633;
      background:radial-gradient(140% 160% at 80% 0%,#102744 0%,#05070c 60%);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.85rem;
      color:#93a4ba;
      text-align:center;
      padding:0 12px;
      white-space:pre-line;
    }

    .metrics-grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:6px;
      margin-bottom:12px;
    }
    @media (max-width:900px){
      .metrics-grid{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:520px){
      .metrics-grid{grid-template-columns:1fr}
    }
    .metric-card{
      border-radius:12px;
      border:1px solid var(--line);
      background:#0c1018;
      padding:8px 10px 9px;
      font-size:.8rem;
    }
    .metric-label{color:#9bb3c7;margin-bottom:3px}
    .metric-value{
      font-size:1rem;
      font-weight:600;
    }
    .metric-unit{font-size:.78rem;color:#7e8a99;margin-left:4px}

    .result-table{
      width:100%;
      border-collapse:collapse;
      font-size:.84rem;
      margin-top:4px;
    }
    .result-table th,
    .result-table td{
      border:1px solid var(--line);
      padding:5px 6px;
      text-align:center;
    }
    .result-table th{
      background:#111319;
      color:#dbe9f5;
    }
    .result-placeholder{
      font-size:.83rem;
      color:#7d8795;
      text-align:center;
    }

    .run-info{
      margin-top:8px;
      font-size:.82rem;
      color:#9bb3c7;
    }
  </style>
</head>
<body>
    <header>
        <div class="logo">OS Platform</div>
        <nav>
          <div class="dropdown">
            <span>Learn</span>
            <div class="dropdown-content">
              <a href="/learn-scheduling.html">스케줄링</a>
              <a href="/learn-paging.html">페이지교체</a>
              <a href="/learn-deadlock.html">데드록</a>
            </div>
          </div>
    
          <div class="dropdown">
            <span>Simulator</span>
            <div class="dropdown-content">
              <a href="/sim-scheduling.html">CPU 스케줄링 시뮬레이터</a>
              <a href="/sim-paging.html">페이지교체 시뮬레이터</a>
              <a href="/sim-deadlock.html">데드록 시뮬레이터</a>
            </div>
          </div>
    
          <div class="dropdown">
            <span>
              <a href="/compare-paging.html" style="color:#fff;text-decoration:none">
                Compare
              </a>
            </span>
          </div>
    
          <div class="dropdown">
            <span>
              <a href="/graph-paging.html" style="color:#fff;text-decoration:none">
                Graph
              </a>
            </span>
          </div>
        </nav>
    
        <div class="actions">
          <div id="authArea"></div>
        </div>
      </header>
    

  <div class="wrap">
    <div class="eyebrow">SIM / CPU Scheduling</div>
    <h1>CPU Scheduling Simulator</h1>
    <p class="lead">
      알고리즘과 프로세스 목록을 설정한 뒤, 시뮬레이션을 실행하면<br/>
      Gantt 차트와 함께 <b>평균 WT / TAT / RT, Throughput</b>까지 한눈에 볼 수 있도록 설계된 페이지입니다.
    </p>

    <div class="sim-layout">
      <!-- 설정 -->
      <section class="panel" aria-label="시뮬레이션 설정">
        <div class="panel-title">시뮬레이션 설정</div>
        <div class="panel-sub">
          알고리즘과 시간 단위를 선택한 뒤, 프로세스를 추가하고 <b>시뮬레이션 실행</b>을 눌러보세요.
        </div>

        <div class="control-row">
          <div class="field">
            <label for="algo-select">알고리즘 선택</label>
            <select id="algo-select">
              <option value="FCFS">FCFS (First Come First Served)</option>
              <option value="SJF">SJF (Shortest Job First)</option>
              <option value="RR">RR (Round Robin)</option>
              <option value="SRT">SRT (Shortest Remaining Time)</option>
            </select>
          </div>

          <div class="field">
            <label for="time-unit">시간 단위</label>
            <select id="time-unit">
              <option value="sec">초 (seconds)</option>
              <option value="ms">밀리초 (milliseconds)</option>
            </select>
          </div>

          <div class="field" id="quantum-field" style="display:none;">
            <label for="time-quantum">Time Quantum (RR 전용)</label>
            <input type="number" id="time-quantum" min="1" value="4" />
          </div>
        </div>

        <div class="btn-row">
          <button type="button" class="btn" id="add-proc-btn">+ 프로세스 추가</button>
          <button type="button" class="btn btn-danger" id="reset-btn">초기화</button>
          <button type="button" class="btn btn-primary" id="run-btn">시뮬레이션 실행</button>
        </div>

        <table class="proc-table" aria-label="프로세스 목록">
          <thead>
            <tr>
              <th style="width:70px;">PID</th>
              <th style="width:110px;">도착 시간 (Arrival)</th>
              <th style="width:110px;">버스트 시간 (Burst)</th>
            </tr>
          </thead>
          <tbody id="proc-body">
            <!-- JS에서 P1부터 추가 -->
          </tbody>
        </table>
      </section>

      <!-- 사용법 -->
      <aside class="panel" aria-label="사용 방법">
        <div class="panel-title">사용 방법 &amp; 팁</div>
        <div class="panel-sub">
          입력은 단순하게, 결과는 직관적으로 볼 수 있도록 구성했습니다.
        </div>
        <ul class="howto-list">
          <li>
            <span class="badge">1</span>
            사용할 <b>스케줄링 알고리즘</b>과 <b>시간 단위</b>를 선택합니다.
          </li>
          <li>
            <span class="badge">2</span>
            <b>프로세스 추가</b> 버튼을 눌러 P1, P2, P3... 순서대로
            <b>도착 시간 / 버스트 시간</b>을 입력합니다.
          </li>
          <li>
            <span class="badge">3</span>
            설정을 모두 마쳤다면 <b>시뮬레이션 실행</b>을 눌러
            아래의 <b>Gantt 차트 / 지표 / 프로세스별 결과</b>를 확인합니다.
          </li>
          <li>
            <span class="badge">4</span>
            다른 케이스를 보고 싶다면 <b>초기화</b>로 목록을 지우고
            새로운 프로세스 세트를 넣어 다시 실행할 수 있습니다.
          </li>
        </ul>

        <div class="note-box">
          현재 결과 계산은 프론트에서 FCFS 방식으로 <b>예시</b>만 보여줍니다.<br/>
          실제 프로젝트에서는 이 부분을 백엔드 스케줄링 로직과 연결해
          <b>정확한 WT / TAT / RT</b>를 가져오면 됩니다.
        </div>
      </aside>
    </div>

    <hr class="sep" />

    <!-- 결과 영역 -->
    <section class="panel" aria-label="시뮬레이션 결과">
      <div class="panel-title">시뮬레이션 결과</div>
      <div class="panel-sub">
        위 설정으로 실행한 결과가 이 영역에 표시됩니다. Gantt 차트, 핵심 지표, 프로세스별 시간 정보를 한 번에 확인하세요.
      </div>

      <div class="chart-shell">
        <div class="chart-placeholder" id="chart-placeholder">
아직 시뮬레이션이 실행되지 않았습니다.
실행 후 이 영역에 Gantt Chart / 타임라인 시각화가 표시됩니다.
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">평균 대기 시간 (Avg WT)</div>
          <div><span class="metric-value" id="avg-wt">–</span><span class="metric-unit" id="wt-unit"></span></div>
        </div>
        <div class="metric-card">
          <div class="metric-label">평균 반환 시간 (Avg TAT)</div>
          <div><span class="metric-value" id="avg-tat">–</span><span class="metric-unit" id="tat-unit"></span></div>
        </div>
        <div class="metric-card">
          <div class="metric-label">평균 응답 시간 (Avg RT)</div>
          <div><span class="metric-value" id="avg-rt">–</span><span class="metric-unit" id="rt-unit"></span></div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Throughput (단위 시간당 완료 수)</div>
          <div><span class="metric-value" id="throughput">–</span><span class="metric-unit">proc / unit</span></div>
        </div>
      </div>

      <table class="result-table" aria-label="프로세스별 시뮬레이션 결과">
        <thead>
          <tr>
            <th>PID</th>
            <th>도착 시간</th>
            <th>버스트 시간</th>
            <th>시작 시각</th>
            <th>완료 시각</th>
            <th>대기 시간 (WT)</th>
            <th>반환 시간 (TAT)</th>
            <th>응답 시간 (RT)</th>
          </tr>
        </thead>
        <tbody id="result-body">
          <tr>
            <td colspan="8" class="result-placeholder">
              시뮬레이션을 실행하면 여기에서 각 프로세스의 시간 정보를 확인할 수 있습니다.
            </td>
          </tr>
        </tbody>
      </table>

      <div class="run-info" id="run-info">
        아직 실행 기록이 없습니다.
      </div>
    </section>
  </div>

  <script>
    // --- 로그인 / 프로필 버튼 ---
    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('authArea');
      if (container) {
        const user = sessionStorage.getItem('user');
        container.innerHTML = (user && user.trim() !== '')
          ? `
          <button class="profile-btn" aria-label="My Page" title="My Page" onclick="location.href='mypage.html'">
            <svg viewBox="0 0 24 24" fill="black" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="8" r="4"></circle>
              <path d="M4 20c0-4 4-6 8-6s8 2 8 6"></path>
            </svg>
          </button>`
          : `<button class="login-btn" onclick="location.href='login.html'">Login</button>`;
      }
    });

    // --- 프로세스 추가/초기화 로직 ---
    let procCount = 0;

    function createProcRow(pidLabel, arrival = 0, burst = 1) {
      const tbody = document.getElementById('proc-body');

      const placeholder = tbody.querySelector('.empty-row');
      if (placeholder) placeholder.remove();

      const tr = document.createElement('tr');

      const tdPid = document.createElement('td');
      tdPid.className = 'pid-cell';
      tdPid.textContent = pidLabel;

      const tdArr = document.createElement('td');
      const inputArr = document.createElement('input');
      inputArr.type = 'number';
      inputArr.min = '0';
      inputArr.step = '1';
      inputArr.value = arrival;
      inputArr.setAttribute('aria-label', pidLabel + ' 도착 시간');
      tdArr.appendChild(inputArr);

      const tdBurst = document.createElement('td');
      const inputBurst = document.createElement('input');
      inputBurst.type = 'number';
      inputBurst.min = '1';
      inputBurst.step = '1';
      inputBurst.value = burst;
      inputBurst.setAttribute('aria-label', pidLabel + ' 버스트 시간');
      tdBurst.appendChild(inputBurst);

      tr.appendChild(tdPid);
      tr.appendChild(tdArr);
      tr.appendChild(tdBurst);

      tbody.appendChild(tr);
    }

    function addProcess() {
      procCount += 1;
      const pidLabel = 'P' + procCount;
      createProcRow(pidLabel);
    }

    function resetSim() {
      const tbody = document.getElementById('proc-body');
      tbody.innerHTML = '';
      procCount = 0;
      addProcess(); // 기본 P1 한 줄

      // 지표 리셋
      document.getElementById('avg-wt').textContent = '–';
      document.getElementById('avg-tat').textContent = '–';
      document.getElementById('avg-rt').textContent = '–';
      document.getElementById('throughput').textContent = '–';
      document.getElementById('wt-unit').textContent = '';
      document.getElementById('tat-unit').textContent = '';
      document.getElementById('rt-unit').textContent = '';
      document.getElementById('result-body').innerHTML =
        '<tr><td colspan="8" class="result-placeholder">시뮬레이션을 실행하면 여기에서 각 프로세스의 시간 정보를 확인할 수 있습니다.</td></tr>';
      document.getElementById('run-info').textContent = '아직 실행 기록이 없습니다.';

      const chartBox = document.getElementById('chart-placeholder');
      chartBox.textContent =
'아직 시뮬레이션이 실행되지 않았습니다.\n실행 후 이 영역에 Gantt Chart / 타임라인 시각화가 표시됩니다.';
    }

    // --- 시뮬레이션 실행 (간단 FCFS 예시 계산) ---
    function runSimulation() {
      const algo = document.getElementById('algo-select').value;
      const timeUnit = document.getElementById('time-unit').value;
      const unitText = (timeUnit === 'ms') ? ' ms' : ' sec';

      const tbody = document.getElementById('proc-body');
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const procs = [];

      rows.forEach((row, idx) => {
        const pid = row.querySelector('.pid-cell')?.textContent?.trim();
        const inputs = row.querySelectorAll('input');
        if (!pid || inputs.length < 2) return;
        const arrival = parseInt(inputs[0].value, 10);
        const burst = parseInt(inputs[1].value, 10);
        if (!Number.isNaN(arrival) && !Number.isNaN(burst) && burst > 0) {
          procs.push({ pid, arrival, burst, index: idx });
        }
      });

      if (procs.length === 0) {
        alert('최소 1개 이상의 프로세스를 입력해야 합니다.');
        return;
      }

      // 여기서는 FCFS 기준으로만 간단 계산 예시 (algo 선택 값과 상관없이 예시용)
      procs.sort((a,b) => a.arrival === b.arrival ? a.index - b.index : a.arrival - b.arrival);

      let time = 0;
      let totalWT = 0, totalTAT = 0, totalRT = 0;

      procs.forEach(p => {
        if (time < p.arrival) time = p.arrival;
        p.start = time;
        p.wait = time - p.arrival;
        p.response = p.wait;              // FCFS에서는 RT = WT
        time += p.burst;
        p.finish = time;
        p.turnaround = p.finish - p.arrival;

        totalWT += p.wait;
        totalTAT += p.turnaround;
        totalRT += p.response;
      });

      const avgWT = (totalWT / procs.length).toFixed(2);
      const avgTAT = (totalTAT / procs.length).toFixed(2);
      const avgRT = (totalRT / procs.length).toFixed(2);
      const throughput = (procs.length / (time || 1)).toFixed(3);

      document.getElementById('wt-unit').textContent = unitText;
      document.getElementById('tat-unit').textContent = unitText;
      document.getElementById('rt-unit').textContent = unitText;
      document.getElementById('avg-wt').textContent = avgWT;
      document.getElementById('avg-tat').textContent = avgTAT;
      document.getElementById('avg-rt').textContent = avgRT;
      document.getElementById('throughput').textContent = throughput;

      // 결과 테이블 채우기
      const resultBody = document.getElementById('result-body');
      resultBody.innerHTML = '';
      procs.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.pid}</td>
          <td>${p.arrival}</td>
          <td>${p.burst}</td>
          <td>${p.start}</td>
          <td>${p.finish}</td>
          <td>${p.wait}</td>
          <td>${p.turnaround}</td>
          <td>${p.response}</td>
        `;
        resultBody.appendChild(tr);
      });

      // 차트 영역에는 실행 순서/총 실행시간 정도만 텍스트로
      const order = procs.map(p => p.pid).join(' → ');
      const chartBox = document.getElementById('chart-placeholder');
      chartBox.textContent =
`[예시 Gantt 정보]
실행 순서: ${order}
총 실행 시간: ${time}${unitText}
(실제 프로젝트에서는 이 영역에 Gantt 차트를 그려 사용하면 됩니다.)`;

      const now = new Date();
      const info = [
        '마지막 실행: ',
        now.toLocaleDateString(), ' ',
        now.toLocaleTimeString(),
        ' | 선택 알고리즘: ', algo,
        ' | 프로세스 수: ', procs.length
      ].join('');
      document.getElementById('run-info').textContent = info;
    }

    // --- 알고리즘별 Time Quantum 필드 토글 ---
    function handleAlgoChange() {
      const algo = document.getElementById('algo-select').value;
      const qField = document.getElementById('quantum-field');
      qField.style.display = (algo === 'RR') ? 'flex' : 'none';
    }

    // --- 리액트(3000)에서 8080으로 링크 강제 ---
    (function () {
      if (location.port === '3000') {
        document.querySelectorAll('.dropdown-content a').forEach(a => {
          const href = a.getAttribute('href');
          if (href && href.startsWith('/')) {
            a.addEventListener('click', function(e){
              e.preventDefault();
              window.location.assign('http://localhost:8080' + href);
            });
          }
        });
      }
    })();

    // 초기 세팅
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('add-proc-btn').addEventListener('click', addProcess);
      document.getElementById('reset-btn').addEventListener('click', resetSim);
      document.getElementById('run-btn').addEventListener('click', runSimulation);
      document.getElementById('algo-select').addEventListener('change', handleAlgoChange);

      resetSim();
      handleAlgoChange();
    });
  </script>
</body>
</html>
